<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SPACShortModel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
      :root{
        --bg: #0a0b0f;
        --bg-elevated: #12141a;
        --bg-surface: #191c24;
        --bg-hover: #1e222d;
        --card: linear-gradient(135deg, rgba(25, 28, 36, 0.9) 0%, rgba(18, 20, 26, 0.95) 100%);
        --card-border: rgba(255, 255, 255, 0.06);
        --card-glow: rgba(99, 102, 241, 0.08);

        --text: #f1f5f9;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --text-dim: #475569;

        --line: rgba(255, 255, 255, 0.06);
        --line-strong: rgba(255, 255, 255, 0.1);

        --accent: #6366f1;
        --accent-glow: rgba(99, 102, 241, 0.3);
        --accent-soft: rgba(99, 102, 241, 0.15);

        --success: #10b981;
        --success-bg: rgba(16, 185, 129, 0.12);
        --success-border: rgba(16, 185, 129, 0.25);

        --danger: #f43f5e;
        --danger-bg: rgba(244, 63, 94, 0.12);
        --danger-border: rgba(244, 63, 94, 0.25);

        --warning: #f59e0b;
        --warning-bg: rgba(245, 158, 11, 0.12);
        --warning-border: rgba(245, 158, 11, 0.25);

        --neutral-bg: rgba(100, 116, 139, 0.12);
        --neutral-border: rgba(100, 116, 139, 0.25);

        --p0: #10b981;
        --p1: #f59e0b;
        --p2: #f97316;
        --p3: #f43f5e;
        --p4: #dc2626;

        --radius: 12px;
        --radius-lg: 16px;
        --radius-sm: 8px;

        --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
        --shadow: 0 4px 24px rgba(0,0,0,0.4);
        --shadow-lg: 0 8px 40px rgba(0,0,0,0.5);
        --shadow-glow: 0 0 40px var(--card-glow);

        --font-display: 'Outfit', -apple-system, sans-serif;
        --font-mono: 'JetBrains Mono', monospace;

        --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      *{box-sizing:border-box}

      html{ scroll-behavior:smooth; }
      html, body{ height:auto; overflow-y:auto; }

      body{
        margin:0;
        font-family: var(--font-display);
        background: var(--bg);
        color: var(--text);
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body::before{
        content:'';
        position:fixed;
        inset:0;
        background-image:
          linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
        background-size: 60px 60px;
        pointer-events:none;
        z-index:0;
      }

      body::after{
        content:'';
        position:fixed;
        top:-50%;
        left:-50%;
        width:200%;
        height:200%;
        background:
          radial-gradient(ellipse at 30% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
          radial-gradient(ellipse at 70% 80%, rgba(244, 63, 94, 0.05) 0%, transparent 50%);
        pointer-events:none;
        z-index:0;
      }

      .wrap{
        position:relative;
        z-index:1;
        max-width: 1280px;
        margin: 0 auto;
        padding: 40px 24px 60px;
      }

      header{
        margin-bottom: 32px;
        animation: fadeIn 0.6s ease-out;
      }

      @keyframes fadeIn{
        from{ opacity:0; transform: translateY(-10px); }
        to{ opacity:1; transform: translateY(0); }
      }

      @keyframes slideUp{
        from{ opacity:0; transform: translateY(20px); }
        to{ opacity:1; transform: translateY(0); }
      }

      .logo-mark{
        display:inline-flex;
        align-items:center;
        gap:12px;
        margin-bottom: 8px;
      }

      .logo-icon{
        width:40px;
        height:40px;
        background: linear-gradient(135deg, var(--accent) 0%, #818cf8 100%);
        border-radius: 10px;
        display:flex;
        align-items:center;
        justify-content:center;
        box-shadow: 0 4px 20px var(--accent-glow);
      }

      .logo-icon svg{
        width:22px;
        height:22px;
        fill:white;
      }

      h1{
        font-size: 48px;
        font-weight: 800;
        line-height: 1.1;
        letter-spacing: -0.03em;
        margin:0;
        background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%);
        -webkit-background-clip:text;
        -webkit-text-fill-color:transparent;
        background-clip:text;
      }

      .sub{
        color: var(--text-muted);
        font-size: 15px;
        font-weight: 400;
        margin: 8px 0 0;
        letter-spacing: 0.01em;
      }

      @media (max-width: 980px){
        h1{ font-size:36px; }
      }

      .stack{
        display:flex;
        flex-direction: column;
        gap: 24px;
        align-items: stretch;
      }

      .card{
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow), var(--shadow-glow);
        backdrop-filter: blur(20px);
        overflow: visible;
        animation: slideUp 0.5s ease-out backwards;
      }

      .card:nth-child(1){ animation-delay: 0.1s; }
      .card:nth-child(2){ animation-delay: 0.2s; }

      .card-head{
        padding: 24px 24px 20px;
        border-bottom: 1px solid var(--line);
        position: relative;
      }

      .card-head::after{
        content:'';
        position:absolute;
        bottom:-1px;
        left:24px;
        right:24px;
        height:1px;
        background: linear-gradient(90deg, var(--accent) 0%, transparent 50%);
        opacity:0.5;
      }

      .card-title{
        font-size: 20px;
        font-weight: 700;
        letter-spacing: -0.02em;
        margin: 0 0 6px;
        color: var(--text);
      }

      .small{
        font-size: 12px;
        color: var(--text-muted);
        letter-spacing: 0.02em;
      }

      .controls{
        display:flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }

      .control{
        display:flex;
        align-items:center;
        gap: 10px;
        padding: 10px 14px;
        border: 1px solid var(--line-strong);
        border-radius: var(--radius-sm);
        background: var(--bg-surface);
        min-height: 44px;
        transition: all var(--transition);
      }

      .control:focus-within{
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-soft);
      }

      .control .small{
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        font-weight: 600;
      }

      .control input, .control select{
        border:none;
        outline:none;
        font-size: 14px;
        font-family: var(--font-display);
        min-width: 160px;
        background: transparent;
        color: var(--text);
      }

      .control input::placeholder{ color: var(--text-dim); }

      .control select{
        min-width: 210px;
        cursor: pointer;
      }

      .control select option{
        background: var(--bg-surface);
        color: var(--text);
      }

      .meta{
        margin-left:auto;
        color: var(--text-muted);
        font-size: 12px;
        font-family: var(--font-mono);
        padding: 6px 12px;
        background: var(--bg-surface);
        border-radius: var(--radius-sm);
        border: 1px solid var(--line);
      }

      .table-wrap{
        overflow-x: auto;
        overflow-y: visible;
        -webkit-overflow-scrolling: touch;
      }

      table{
        width: 100%;
        border-collapse: collapse;
        min-width: 0;
        table-layout: auto;
      }

      th, td{
        padding: 14px 16px;
        border-bottom: 1px solid var(--line);
        vertical-align: middle;
        text-align: left;
        white-space: nowrap;
      }

      th{
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        background: var(--bg-elevated);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      tbody tr{ transition: background var(--transition); }
      tbody tr:hover{ background: var(--bg-hover); }

      .ticker{
        font-family: var(--font-mono);
        font-weight: 700;
        font-size: 13px;
        letter-spacing: .04em;
        color: var(--text);
      }

      .muted{ color: var(--text-muted); }

      .chip{
        display:inline-flex;
        align-items:center;
        gap: 6px;
        padding: 5px 10px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 11px;
        letter-spacing: .03em;
        text-transform: uppercase;
        border: 1px solid var(--neutral-border);
        background: var(--neutral-bg);
        color: var(--text-secondary);
        white-space: nowrap;
        transition: all var(--transition);
      }

      .chip.ok{
        background: var(--success-bg);
        border-color: var(--success-border);
        color: var(--success);
      }

      .chip.bad{
        background: var(--danger-bg);
        border-color: var(--danger-border);
        color: var(--danger);
      }

      .chip.warn{
        background: var(--warning-bg);
        border-color: var(--warning-border);
        color: var(--warning);
      }

      .state-chip{
        background: var(--accent-soft);
        border-color: rgba(99, 102, 241, 0.3);
        color: var(--accent);
      }

      .dot{
        width: 8px;
        height: 8px;
        border-radius: 999px;
        display:inline-block;
        box-shadow: 0 0 8px currentColor;
      }

      .spark{
        width: 100px;
        height: 28px;
        display:block;
      }

      .spark path{
        fill:none;
        stroke-width:1.5;
        stroke-linecap:round;
        stroke-linejoin:round;
      }

      .spark .baseline{
        stroke: var(--line-strong);
        stroke-width: 1;
        stroke-dasharray: 2 2;
      }

      .spark .line{
        stroke: var(--accent);
        filter: drop-shadow(0 0 4px var(--accent-glow));
      }

      .spark .line.up{
        stroke: var(--success);
        filter: drop-shadow(0 0 4px rgba(16, 185, 129, 0.4));
      }

      .spark .line.down{
        stroke: var(--danger);
        filter: drop-shadow(0 0 4px rgba(244, 63, 94, 0.4));
      }

      .priceCell{
        display:flex;
        gap: 12px;
        align-items:center;
      }

      .pct{
        font-family: var(--font-mono);
        font-weight: 600;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
      }

      .pct.up{ color: var(--success); background: var(--success-bg); }
      .pct.down{ color: var(--danger); background: var(--danger-bg); }
      .pct.flat{ color: var(--text-muted); background: var(--neutral-bg); }

      .note{
        padding: 16px 24px;
        color: var(--text-muted);
        font-size: 13px;
      }

      .footer{
        padding: 20px 24px;
        border-top: 1px solid var(--line);
        background: var(--bg-elevated);
        border-bottom-left-radius: var(--radius-lg);
        border-bottom-right-radius: var(--radius-lg);
      }

      .defs{
        display:flex;
        gap: 10px;
        flex-wrap: wrap;
        margin:0;
        padding:0;
        list-style:none;
      }

      .defs li{
        border: 1px solid var(--line-strong);
        background: var(--bg-surface);
        border-radius: var(--radius-sm);
        padding: 8px 12px;
        font-size: 12px;
        color: var(--text-secondary);
        font-family: var(--font-mono);
      }

      .defs b{
        display:inline-block;
        min-width: 28px;
        color: var(--accent);
        font-weight: 600;
      }

      .tight th, .tight td{ padding: 12px 14px; }

      @media (max-width: 980px){
        .col-bucket{ display:none; }
        .spark{ width:80px; }
      }

      @media (max-width: 720px){
        .col-asof{ display:none; }
        .col-price{ display:none; }
      }

      ::-webkit-scrollbar{ width: 8px; height: 8px; }
      ::-webkit-scrollbar-track{ background: var(--bg-surface); border-radius: 4px; }
      ::-webkit-scrollbar-thumb{ background: var(--text-dim); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover{ background: var(--text-muted); }

      .scope-in{
        color: var(--success);
        font-weight: 600;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .scope-out{
        color: var(--text-dim);
        font-weight: 500;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .event-arrow{
        color: var(--text-dim);
        margin: 0 4px;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header>
        <div class="logo-mark">
          <div class="logo-icon">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 13h2v8H3v-8zm4-5h2v13H7V8zm4-5h2v18h-2V3zm4 8h2v10h-2V11zm4-3h2v13h-2V8z"/>
            </svg>
          </div>
        </div>
        <h1>SPACShortModel</h1>
        <p class="sub" id="subtitle">Loading...</p>
      </header>

      <div class="stack">
        <section class="card">
          <div class="card-head">
            <h2 class="card-title">Recent Events</h2>
            <div class="small">State transitions are logged as discrete events</div>
          </div>

          <div class="table-wrap">
            <table class="tight">
              <thead>
                <tr>
                  <th style="width: 120px;">Ticker</th>
                  <th style="width: 140px;">Date</th>
                  <th>Transition</th>
                </tr>
              </thead>
              <tbody id="events"></tbody>
            </table>
          </div>

          <div class="note" id="eventsNote"></div>
        </section>

        <section class="card">
          <div class="card-head">
            <div style="display:flex; gap:16px; align-items:baseline; flex-wrap:wrap;">
              <h2 class="card-title" style="margin:0;">Current State</h2>
              <div class="meta" id="updated">Updated: --</div>
            </div>

            <div class="controls" style="margin-top:16px;">
              <div class="control">
                <span class="small">Search</span>
                <input id="q" placeholder="Ticker or bucket..." />
              </div>

              <div class="control">
                <span class="small">Scope</span>
                <select id="scope">
                  <option value="all">All</option>
                  <option value="in">In scope (watch)</option>
                  <option value="out">Out of scope (ignore)</option>
                </select>
              </div>

              <div class="control">
                <span class="small">State</span>
                <select id="stateFilter">
                  <option value="all">All</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table class="tight">
              <thead>
                <tr>
                  <th style="width: 90px;">Ticker</th>
                  <th class="col-bucket" style="width: 220px;">Bucket</th>
                  <th style="width: 130px;">State</th>
                  <th class="col-asof" style="width: 100px;">As Of</th>
                  <th style="width: 140px;">Pressure</th>
                  <th style="width: 100px;">Demand</th>
                  <th style="width: 100px;">Cost</th>
                  <th style="width: 100px;">Persist</th>
                  <th style="width: 100px;">Strategy</th>
                  <th class="col-price" style="width: 180px;">Price (1M)</th>
                  <th style="width: 80px;">Scope</th>
                </tr>
              </thead>
              <tbody id="rows"></tbody>
            </table>
          </div>

          <div class="footer">
            <ul class="defs">
              <li><b>C1</b> Demand/Margin</li>
              <li><b>C2</b> Cost/Capex</li>
              <li><b>C3</b> Persistence</li>
              <li><b>C4</b> Strategic Init.</li>
            </ul>
            <div class="small" style="margin-top:12px; color: var(--text-dim);">
              Pressure score reflects triggered conditions (C1-C4). Sparkline renders when 1-month price data is available.
            </div>
          </div>
        </section>
      </div>
    </div>

    <script>
      function safeInt(v){
        const n = Number(v);
        return Number.isFinite(n) ? n : 0;
      }

      function ynChip(flag){
        const on = !!flag;
        if(on) return `<span class="chip bad">FLAG</span>`;
        return `<span class="chip ok">OK</span>`;
      }

      function pressureDot(score){
        const s = safeInt(score);
        let c = "var(--p0)";
        if(s === 1) c = "var(--p1)";
        if(s === 2) c = "var(--p2)";
        if(s === 3) c = "var(--p3)";
        if(s >= 4) c = "var(--p4)";
        return `<span class="dot" style="background:${c}; color:${c}"></span>`;
      }

      function pressureLabel(score){
        const s = safeInt(score);
        if(s === 0) return "Stable";
        if(s === 1) return "Watch";
        if(s === 2) return "Elevated";
        if(s === 3) return "High";
        return "Critical";
      }

      function svgSparkline(values, pctChange){
        if(!Array.isArray(values) || values.length < 2) return "";
        const w = 100, h = 28, pad = 4;

        const clean = values.map(v => Number(v)).filter(v => Number.isFinite(v));
        if(clean.length < 2) return "";

        let min = Math.min(...clean);
        let max = Math.max(...clean);
        if(min === max){ min -= 1; max += 1; }

        const xStep = (w - pad*2) / (clean.length - 1);
        const y = (v) => {
          const t = (v - min) / (max - min);
          return (h - pad) - t * (h - pad*2);
        };

        let d = "";
        for(let i=0;i<clean.length;i++){
          const x = pad + i * xStep;
          const yy = y(clean[i]);
          d += (i===0 ? "M" : " L") + x.toFixed(2) + " " + yy.toFixed(2);
        }

        const baseY = y(clean[0]).toFixed(2);
        const pct = Number(pctChange);
        let lineClass = "line";
        if(Number.isFinite(pct)) {
          if(pct > 0.25) lineClass = "line up";
          else if(pct < -0.25) lineClass = "line down";
        }

        return `
          <svg class="spark" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none" aria-hidden="true">
            <path class="baseline" d="M${pad} ${baseY} L${w-pad} ${baseY}"></path>
            <path class="${lineClass}" d="${d}"></path>
          </svg>
        `;
      }

      function pctClass(p){
        const n = Number(p);
        if(!Number.isFinite(n)) return "flat";
        if(n > 0.25) return "up";
        if(n < -0.25) return "down";
        return "flat";
      }

      function fmtPct(p){
        const n = Number(p);
        if(!Number.isFinite(n)) return "n/a";
        const sign = n > 0 ? "+" : "";
        return `${sign}${n.toFixed(1)}%`;
      }

      function priceCell(row){
        const p = row.price_1m;
        if(!p || !Array.isArray(p.closes) || p.closes.length < 2){
          return `<div class="priceCell"><span class="small muted">--</span></div>`;
        }
        const spark = svgSparkline(p.closes, p.pct_change);
        const pct = fmtPct(p.pct_change);
        const cls = pctClass(p.pct_change);
        return `
          <div class="priceCell">
            ${spark}
            <span class="pct ${cls}">${pct}</span>
          </div>
        `;
      }

      function buildStateOptions(rows){
        const states = new Set(rows.map(r => String(r.state || "").trim()).filter(Boolean));
        const sel = document.getElementById("stateFilter");
        const current = sel.value || "all";
        const opts = ["all", ...Array.from(states).sort()];
        sel.innerHTML = opts.map(s => `<option value="${s}">${s === "all" ? "All" : s}</option>`).join("");
        sel.value = opts.includes(current) ? current : "all";
      }

      // IMPORTANT: This builds rows from companies list, not just latest_state,
      // so you see all 20 even if some are out of scope or have no recent evaluation.
      function normalizeData(data){
        const companies = Array.isArray(data.companies) ? data.companies : [];
        const latestState = Array.isArray(data.latest_state) ? data.latest_state : [];
        const events = Array.isArray(data.events) ? data.events : [];

        const latestById = new Map();
        for(const ms of latestState){
          if(ms && ms.company_id != null){
            latestById.set(String(ms.company_id), ms);
          }
        }

        const companiesById = new Map();
        for(const c of companies){
          if(c && c.company_id != null){
            companiesById.set(String(c.company_id), c);
          }
        }

        const rows = companies.map(c => {
          const id = String(c.company_id);
          const ms = latestById.get(id) || {};

          const inScope = !!c.in_scope;

          const c1 = !!ms.condition_1;
          const c2 = !!ms.condition_2;
          const c3 = !!ms.condition_3;
          const c4 = !!ms.condition_4;
          const pressure = [c1,c2,c3,c4].reduce((a,b)=>a+(b?1:0),0);

          // If it's out of scope, we label it OUT_OF_SCOPE regardless of ms.state.
          // If it's in scope but no state yet, we show NO_DATA.
          let state = ms.state || "";
          if(!inScope) state = "OUT_OF_SCOPE";
          if(inScope && !state) state = "NO_DATA";

          return {
            company_id: id,
            ticker: c.ticker || id,
            bucket: c.bucket || "--",
            in_scope: inScope ? 1 : 0,
            as_of: ms.as_of || "",
            state,
            c1, c2, c3, c4,
            pressure,
            price_1m: ms.price_1m || null,
          };
        });

        const normalizedEvents = events.map(e => ({
          company_id: e.company_id,
          as_of: e.as_of,
          prev_state: e.prev_state,
          new_state: e.new_state
        }));

        return { rows, normalizedEvents, companiesById };
      }

      function renderLatest(rows){
        const tbody = document.getElementById("rows");
        if(!rows.length){
          tbody.innerHTML = `<tr><td colspan="11" class="muted">No matches</td></tr>`;
          return;
        }

        tbody.innerHTML = rows.map(r => `
          <tr>
            <td class="ticker">${r.ticker}</td>
            <td class="col-bucket muted">${r.bucket || "--"}</td>
            <td><span class="chip state-chip">${r.state}</span></td>
            <td class="col-asof muted">${r.as_of || ""}</td>
            <td>
              <span class="chip">
                ${pressureDot(r.pressure)}
                ${r.pressure} ${pressureLabel(r.pressure)}
              </span>
            </td>
            <td>${ynChip(r.c1)}</td>
            <td>${ynChip(r.c2)}</td>
            <td>${ynChip(r.c3)}</td>
            <td>${ynChip(r.c4)}</td>
            <td class="col-price">${priceCell(r)}</td>
            <td><span class="${r.in_scope ? 'scope-in' : 'scope-out'}">${r.in_scope ? "IN" : "OUT"}</span></td>
          </tr>
        `).join("");
      }

      function renderEvents(events, companiesById){
        const tbody = document.getElementById("events");
        const note = document.getElementById("eventsNote");

        if(!events.length){
          tbody.innerHTML = `<tr><td colspan="3" class="muted">No state transitions recorded</td></tr>`;
          note.textContent = "";
          return;
        }

        tbody.innerHTML = events.slice(0, 25).map(e => {
          const ticker = companiesById.get(String(e.company_id))?.ticker || e.company_id;
          return `
            <tr>
              <td class="ticker">${ticker}</td>
              <td class="muted">${e.as_of || ""}</td>
              <td><span class="chip">${e.prev_state}<span class="event-arrow">â†’</span>${e.new_state}</span></td>
            </tr>
          `;
        }).join("");

        note.textContent = "";
      }

      function applyFilters(allRows){
        const q = (document.getElementById("q").value || "").trim().toLowerCase();
        const scope = document.getElementById("scope").value;
        const state = document.getElementById("stateFilter").value;

        return allRows.filter(r => {
          if(scope === "in" && r.in_scope !== 1) return false;
          if(scope === "out" && r.in_scope !== 0) return false;
          if(state !== "all" && String(r.state) !== state) return false;

          if(!q) return true;
          const hay = `${r.ticker} ${r.bucket} ${r.state}`.toLowerCase();
          return hay.includes(q);
        });
      }

      async function load(){
        const res = await fetch("./dashboard.json", { cache: "no-store" });
        if(!res.ok) throw new Error(`Failed to load dashboard.json (${res.status})`);
        const data = await res.json();

        const { rows, normalizedEvents, companiesById } = normalizeData(data);

        const inCount = rows.filter(r => r.in_scope === 1).length;
        document.getElementById("subtitle").textContent = `Tracking ${rows.length} companies (in scope: ${inCount})`;
        document.getElementById("updated").textContent = `Updated: ${data.generated_at || "--"}`;

        buildStateOptions(rows);

        function rerender(){
          const filtered = applyFilters(rows);
          renderLatest(filtered);
          renderEvents(normalizedEvents, companiesById);
        }

        document.getElementById("q").addEventListener("input", rerender);
        document.getElementById("scope").addEventListener("change", rerender);
        document.getElementById("stateFilter").addEventListener("change", rerender);

        rerender();
      }

      load().catch(err => {
        document.getElementById("subtitle").textContent = "Connection failed";
        document.getElementById("rows").innerHTML =
          `<tr><td colspan="11" style="color:var(--danger); font-weight:600;">${err.message}</td></tr>`;
        document.getElementById("events").innerHTML =
          `<tr><td colspan="3" style="color:var(--danger); font-weight:600;">${err.message}</td></tr>`;
      });
    </script>
  </body>
</html>